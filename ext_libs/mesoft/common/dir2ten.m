function B_tensor= dir2ten(b_val, dirVc, measureNo, fName)
%function B_tensor= dir2ten(b_val, dirVc, measureNo, fName)
%
%
% Bjoern W. Kreher
% 03/03
%
% UNIX

if ~exist('fName')
    fName= [];
end

if ischar(dirVc) && strcmp(dirVc, 'GE')
    dirVc= [-0.387747134121 -0.296393661931 0.872813242996  ; ...
            -0.946163995722 -0.081321931027 0.313305660232  ; ...
            0.922518214794 -0.384882209717 0.028737223536  ; ...
            -0.444901340191 -0.161185017106 -0.880955270009  ; ...
            0.088648379736 -0.929886599560 0.357004729282  ; ...
            -0.398858764491 0.828672486485 0.392700389778  ; ...
            -0.707421617532 0.031786637059 0.706076670591  ; ...
            -0.441719326768 0.343437931108 -0.828815072158  ; ...
            0.984543274106 0.070601203125 -0.160281039210  ; ...
            -0.816864993569 0.449497285481 0.361502105980  ; ...
            -0.973222292055 -0.160402482040 -0.164649366846  ; ...
            0.365922889995 0.925434114895 -0.098347026224  ; ...
            -0.697928959906 -0.475145821454 0.535846634103  ; ...
            -0.194286490773 0.979839225871 -0.046560186303  ; ...
            0.421934676133 -0.626891396224 -0.654964355074  ; ...
            0.918294577668 -0.058522138943 0.391548500034  ; ...
            -0.951258678509 0.302296624642 -0.061021941069  ; ...
            0.482260349695 -0.174024786406 -0.858568767676  ; ...
            -0.017747824887 0.566474680917 -0.823888008525  ; ...
            -0.008439275026 -0.843382140828 -0.537247934542  ; ...
            -0.022003496707 0.063860489010 -0.997716234245  ; ...
            0.302920122261 -0.640449793751 0.705736113015  ; ...
            0.605795821812 0.751026435800 0.262622761778  ; ...
            -0.801088034306 0.039519118666 -0.597240488038  ; ...
            -0.197614702014 -0.693865338491 0.692458895234  ; ...
            -0.822315620723 -0.565236505598 0.065610309056  ; ...
            -0.531572028134 -0.807120477633 -0.256880737876  ; ...
            0.900257095184 0.382874752951 0.207229549349  ; ...
            0.043757932112 -0.416578339326 -0.908046105978  ; ...
            -0.654348201408 0.755830304425 -0.023430369769  ; ...
            0.380464261169 0.645279718315 0.662465871652  ; ...
            0.819307000804 -0.266629899103 -0.507586973175  ; ...
            0.721142532083 -0.480787014528 0.498795845093  ; ...
            0.549296621645 -0.805702982944 0.221621128787  ; ...
            0.696135340591 -0.669944149585 -0.258012449344  ; ...
            -0.364655265727 -0.606149719157 -0.706830287370  ; ...
            0.090729077048 -0.273405988981 0.957610254627  ; ...
            -0.511611491293 0.471016167011 0.718607996331  ; ...
            0.693341730595 0.289001415041 0.660117737014  ; ...
            -0.751543758000 0.486149073628 -0.445915976414  ; ...
            0.780508167624 0.586409922872 -0.216634260053  ; ...
            0.100583708102 0.932608599035 0.346589265082  ; ...
            -0.219939025696 0.158237287980 0.962594299624  ; ...
            0.780300794447 0.223992497730 -0.583916116532  ; ...
            -0.755047655881 -0.439220995009 -0.486814086579  ; ...
            0.478715333951 0.665543534564 -0.572611065768  ; ...
            -0.152870187393 -0.986482345681 -0.059019382124  ; ...
            0.388991446276 0.292599882564 -0.873539331368  ; ...
            0.066544469261 0.886002068699 -0.458881431170  ; ...
            0.306611784146 -0.934865622332 -0.178928706485  ; ...
            -0.072445525400 0.640718077698 0.764350698803  ; ...
            -0.456711407833 -0.838931327882 0.295988035322  ; ...
            -0.392354846453 0.776467536851 -0.493108343755  ; ...
            0.550316062949 -0.160226448479 0.819438659125  ; ...
            0.252720179080 0.232824243654 0.939108823648 ];
    measureNo= 60;
elseif ischar(dirVc) && strcmp(dirVc, 'bucky')
    [dummy, dirVc]= bucky;
    clear dummy
    measureNo= 66;
end


startV= measureNo - size(dirVc, 1) + 1;
B_tensor= zeros(3, 3, measureNo);

for i= 1:3
    for j= 1:3
        B_tensor(i, j, startV:end)= dirVc(:, i).*dirVc(:, j);
    end
end

B_tensor= b_val*B_tensor;

if ~isempty(fName)
    save(fName, 'B_tensor');
end